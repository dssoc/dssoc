---
title: "Lab Instructions and Data Descriptions"
author: "Data Science and Society (Sociology 367)"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

In this document I'll first give detailed instructions for the labs and then give descriptions for each dataset we will be using this semester.


# Instructions

**Each week's lab should be submitted to your TA via Slack direct message by the deadline indicated on the course website.** You should start with the markdown file linked at the top of the lab, and you will submit two files for each lab: an [R Markdown (.Rmd) file](https://rmarkdown.rstudio.com/authoring_quick_tour.html) containing solution code and written responses (if required) that answer each question, and an HTML file (.html) generated by knitting that file. The TA should be able to knit your R Markdown file to reproduce your html file exactly without any additional steps, and the knitted HTML file should display ONLY your code and  the output needed to answer the question (please do not show intermediate output in your final product). The output from your solution code should be easy to read and you will lose points if your knitted html file includes extraneous output that makes your solution harder to read.

**Be sure to do the required readings first.** While many of the problems can be solved using approaches from the lecture videos, lab videos, or required readings, you may need to do some searching on the internet to solve some of the problems. This will be a valuable skill to learn as you develop your data science skillset. Finding answers on the web might be hard at first as you learn the language of coding, so feel free to share web links on the `#lab-help` channel of Slack.

**Your solutions to every problem should be general enough that it would produce the same output if we swapped the input data for another dataframe with the same columns but a different row order.** This means, among other things, that you should not rely on numerical subscripts (e.g. `my_dataframe[1]`) to get a specific row in your code (unless you sorted the rows first) - this is because your code should work when the dataframe rows occur in a different order. Your solutions also cannot include hard-coded answers - it must produce the output directly in the code using the provided datasets. You may not enter values related to your solution in the code (except as comments). Your code should always appear in the code blocks that look include the text `# your code here` (or something similar). Some solutions require written text instead of a code block. In that case, I will provide a block that begins and ends with "\`\`\`" and ends with "\`\`\`" instead of beginning with "\`\`\`\{r\}" and ending with a "\`\`\`" as a code block does.

**Visualizations should be readible.** Each plot should have axis labels, all labels must be readable, and we should easily be able to tell what your figure is showing. Failure to make clear visualizations will result in point deductions.


# Lab File List

This is a list of all Labs and their associated markdown files:

0. [Example R Markdown File (ungraded)](/assignments/Lab_0.html) ([markdown](/assignments/Lab_0.Rmd))
1. [R Basics](/assignments/Lab_1.html) ([markdown](/assignments/Lab_1.Rmd))
2. [Data Visualization](/assignments/Lab_2.html) ([markdown](/assignments/Lab_2.Rmd))
3. [Data Wrangling](/assignments/Lab_3.html) ([markdown](/assignments/Lab_3.Rmd))
4. [Programming Basics](/assignments/Lab_4.html) ([markdown](/assignments/Lab_4.Rmd))
5. [Coding Social Networks](/assignments/Lab_5.html) ([markdown](/assignments/Lab_5.Rmd))
<!--
6. [Working with APIs](/assignments/Lab_6.html) ([markdown](/assignments/Lab_6.Rmd))
7. [Modeling (A Brief Introduction)](/assignments/Lab_7.html) ([markdown](/assignments/Lab_7.Rmd))
8. [Introduction to text analysis](/assignments/Lab_8.html) ([markdown](/assignments/Lab_8.Rmd))
9. [Word counts and Dictionaries](/assignments/Lab_9.html) ([markdown](/assignments/Lab_9.Rmd))
10. [Topic Modeling](/assignments/Lab_10.html) ([markdown](/assignments/Lab_10.Rmd))
-->

# Dataset Description

Now I will describe the datasets we will use for the class. We will use a total of three different [RData files](https://bookdown.org/ndphillips/YaRrr/rdata-files.html):


+ [`congress.RData`](https://dssoc.github.io/datasets/congress.RData): contains basic information about each member of congress.
+ [`committees.RData`](https://dssoc.github.io/datasets/congress.RData): contains basic information about each member of congress.
+ [`senator_tweets.RData`](https://dssoc.github.io/datasets/senator_tweets.RData): a small sample of Tweets from accounts associated with each senator (a subset of all congress members) in the `congress` dataset.
+ [`senator_wiki.RData`](https://dssoc.github.io/datasets/senator_wiki.RData): text from wikipedia pages of each Senator in the `congress` dataset with a valid Wikipedia ID.

## The `congress.RData` Dataset

[Download congress.RData](https://dssoc.github.io/datasets/congress.RData)

This dataset contains information about each member of congress that was in-office as of January 11, 2021 and their committee memberships. It was retrieved from the `congress-current.csv` file of the [congress-legislators repository](https://github.com/unitedstates/congress-legislators), a database "maintained through a combination of manual edits by volunteers (from GovTrack, ProPublica, MapLight, FiveThirtyEight, and others) and automated imports from a variety of sources." From this source we use the `legislators-current` dataset.

You will use this line of code to download the Rdata file from the course website and open it directly in RStudio. In theory, you could also download the file and point the `load()` function to that file on your computer, but please use this line so your code is easily reproducible on any computer for grading purposes.

```{r}
load(url('https://dssoc.github.io/datasets/congress.RData'))
```

This dataset consists of two different variables:

+ `congress`: basic information like name, birthdate, state of representation, gender, and political party for each member of congress. 
+ `congress_contact`: contact information including social media accounts and phone number for each member of congress.

### `congress` Dataframe

Each row in this dataframe corresponds to a member of congress. type, party, and gender are factor variables and birthdate is a parsed date column.

```{r}
congress %>% summary()
congress %>% head()
```
Here are some important notes about some of the columns:


#### What is `bioguide_id`?

This is a unique identifier for each member of congress. You will want to use this for data merging or other tasks that require unique identifiers because there is always the possibility that two congress members will have the same full name. You can find more information on [congress.gov](https://www.congress.gov/help/field-values/member-bioguide-ids).

```{r}
congress %>% 
  select(bioguide_id, full_name) %>% 
  head()
```


#### Senators VS Representatives

In United States politics, members of congress are divided into two groups: senators and representatives. This information is stored in the `type` column. To get only senators, you can use `type == 'sen'` and to get representatives you can use `type == 'rep'`

```{r}
congress %>% 
  count(type)
```

#### Political Parties

In United States politics, there are currently three political parties represented in congress: Democrats, Republicans, and Independents. Note that there are far fewer Independents than other members of congress. For some problems, you will be asked to filter out Independents.

```{r}
congress %>% 
  count(party)
```
#### Birthdate and Date Columns

For convenience, I have parsed the birthdate data into a `date` type. You can use the `lubridate` package to create new variables from a `date` column. Here I show how to get the name of the month associated with each birthdate.

```{r}
library(lubridate)
congress %>% 
  mutate(month=month(birthdate, label=TRUE)) %>% 
  select(full_name, month) %>% 
  head()
```



### `congress_contact` Dataframe

This datafrme includes contact information for each member of congress.

```{r}
congress_contact %>% summary()
congress_contact %>% head()
```

## The `committees.RData` Dataset

[Download committees.RData](https://dssoc.github.io/datasets/committees.RData)

```{r}
load(url('https://dssoc.github.io/datasets/committees.RData'))
```

This dataset was obtained from the `committees-current` and `committee-membership-current` data from the same source described above. Conceptually, each committee is composed of several subcommittees, and we have membership data at both levels. The parsed version I have created consists of three dataframes:

+ `committees`: a list of committees and descriptions of their jurisdictions. The `thomas_id` column is a unique reference to that committee.
+ `subcommittees`: a list of subcommittees and their parent committee.
+ `committee_membership`: committee and subcommittee membership for each member of congress. Note that each row corresponds to a membership to either a committee or a subcommittee, not both.

### committees

```{r}
committees %>% summary()
committees %>% head()
```

### `subcommittees`

```{r}
subcommittees %>% summary()
subcommittees %>% head()
```

### `committee_memberships`

This dataframe is a little trickier to work with than the other two because it links senators to BOTH full committees and subcommittees. Because subcommittees are already nested within committees, it can present some challenges. For instance, if we want to get the number of full committees that congress members belong to, we wouldn't want to count both committees and subcommittees together. I'll show how to work with these multiple levels below.

The columns are fairly straightforward. `thomas_id` is a unique reference to the committee or subcommittee, and `bioguide_id` is a reference to the member of congress. `party`, `rank`, and `title` give more information about the particular kinds of relationship.
```{r}
committee_memberships %>% summary()
committee_memberships %>% head()
```

If for instance, we wanted to get information about full committees only, we'd join the `congress` dataframe with the `committees` dataframe. This will filter out all rows of `committee_memberships` that are not associated with a full committee.

```{r}
full_committee_memberships <- committees %>% 
  inner_join(committee_memberships, on=thomas_id)

full_committee_memberships %>% head()
full_committee_memberships %>% summary()
```

This will filter out all rows of `committee_memberships` that are not associated with a subcommittee.

```{r}
subcommittee_memberships <- subcommittees %>% 
  inner_join(committee_memberships, on=thomas_id)

subcommittee_memberships %>% head()
subcommittee_memberships %>% summary()
```

You will likely need to use these code snippets for some assignment problems.


## The `senator_tweets.RData` Dataset

[Download senator_tweets.RData](https://dssoc.github.io/datasets/senator_tweets.RData)

Use this code to load the dataset:

```{r}
load(url('https://dssoc.github.io/datasets/senator_tweets.RData'))
```

To collect this data, I began with a large list of status ids from [this page](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/UIVHQR).

+ `senator_tweet_ids`: random sample of 500 status ids. You can request the data from Twitter using `rtweet::lookup_tweets`.
+ `senator_tweet_sample`: random sample of 500 tweets from the full dataset collected using `rtweet::lookup_tweets`. Sample is different from `senator_status_ids`.

```{r}
senator_tweet_ids %>% head()
senator_tweet_sample %>% summary()
senator_tweet_sample %>% head()
```

As you can see from this output, the `status_id`s of the full tweets and just the ids is entirely disjoint. They are sampled from the same full set of `status_id`s though.

```{r}
senator_tweet_sample$status_id %>% setdiff(senator_tweet_ids) %>% length()
senator_tweet_ids %>% setdiff(senator_tweet_sample$status_id) %>% length()
```

## The `senator_wiki.RData` Dataset

This dataset includes text from the Wikipedia pages for each of the Senators (not Representatives) in our dataset that aligned with the Wikipedia ids in the [congress-legislators repository](https://github.com/unitedstates/congress-legislators).


[Download senator_wiki.RData](https://dssoc.github.io/datasets/senator_wiki.RData)

Use this code to load the dataset:

```{r}
load(url('https://dssoc.github.io/datasets/senator_wiki.RData'))
```

The `summary` and `text` columns were provided directly from Wikipedia, and I created the `subtext` column by truncating the `text` data to exactly 5000 characters.

```{r}
senator_wiki %>% head()
senator_wiki %>% summary()
```

Now I'll show the average lengths for each of the text columns. Notice that all subtext columns have exactly 5000 characters - the column was created by truncating the text column. This truncated version has the added benefit of working well with topic modeling algorithms.

```{r}
senator_wiki %>% 
  summarize(
    summary_av=mean(str_length(summary)), summary_sd=sd(str_length(summary)), 
    text_av=mean(str_length(text)), text_sd=sd(str_length(text)), 
    subtext_av=mean(str_length(subtext)), subtext_sd=sd(str_length(subtext))
  )
```

